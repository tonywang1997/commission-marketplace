<div class="profile-container">
  	<div class="avatar-container">
  		<% if user.avatar.attached? %>
        <%= image_tag user.avatar.variant(resize: "100x100!"), class: "rounded-circle avatar-img"%>
      <% else %>
        <img class="rounded-circle avatar-img"
        src="https://assets.currencycloud.com/wp-content/uploads/2018/01/profile-placeholder.gif" 
        width="100" height="100" class="rounded-circle">
      <% end %>
      <div class="edit-button-container">  
        <button class="edit-button" data-toggle= "modal"
                data-target = "#avatarModal">
          <span>
            <svg width="30" height="30" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
              <g><path d="M14,15 L17.25,14.917 C16.227,16.727 13.877,17.881 11.778,17.881 C8.601,17.881 6.016,15 6.016,12 L5.016,12 C5.016,16 8.049,18.881 11.778,18.881 C15.833,18.881 18,15.667 18,15.667 L18,19 L19,19 L19,14 L14,14 L14,15 Z M10,9 L6.758,9.083 C7.781,7.273 10.135,6.119 12.234,6.119 C15.411,6.119 18,9 18,12 L19,12 C19,8 15.959,5.119 12.23,5.119 C8.175,5.119 6,8.333 6,8.333 L6,5 L5,5 L5,10 L10,10 L10,9 Z">
                </path>
              </g>
            </svg>
          </span>
          <span>Change</span>
        </button>
      </div>
    </div>  

    <div class="profile-info">
        <div class="username">
        	<%= @user.user_name %>
        </div>
        <div class="email">
          <%= @user.email_address %>
          <a href=<%= "/storefront/#{@user.id}"%> 
            style="margin-left:10px;">storefront</a>  
        </div>
        <div class="bio">
          <p id="bio_text"><%= @user.biography %></p> 
          <%= link_to fa_icon("edit lg"), '#', class: "edit_bio",
            'data-toggle' => "modal", 'data-target' => "#bioModal",
            'onclick' => "bioDefaultValue()" %>
        </div>
    </div>
</div>

<div class="modal fade" id="bioModal" tabindex="-1" 
     role="dialog" aria-labelledby="bioModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <%= form_with(url: biography_url, model: user, remote: true) do |f| %>
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Tell the community about yourself</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <%= f.text_area :bio, id: "bio-input" %>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <%= f.submit "Submit", class: "btn btn-primary", id: "bio-submit" %>
        </div>

      <% end %>
    </div>
  </div>
</div>

<div class="modal fade" id="avatarModal" tabindex="-1" role="dialog" aria-labelledby="avatarModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <%= form_with(url: avatar_url, model: user, remote: true) do |f| %>
        <div class="modal-header">
          <h5 class="modal-title" id="avatarModalLabel">Upload your avatar</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body mx-3">
          <% if user.avatar.attached? %>
            <%= image_tag user.avatar.variant(resize: "100x100!"), 
              class: "rounded-circle avatar-img"%>
          <% else %>
            <img class="rounded-circle" src="https://assets.currencycloud.com/wp-content/uploads/2018/01/profile-placeholder.gif"  width="100" height="100">
          <% end %>
          <%= f.file_field :avatar, id: "avatar-input", accept: "image/*",
              onchange: "loadAvatar(event)" %>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <%= f.submit "Submit", class: "btn btn-primary", id: "avatar-submit" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script type="text/javascript">
  function bioDefaultValue() {
    var default_value = document.getElementById("bio_text").innerHTML;
    document.getElementById("bio-input").defaultValue = default_value;
  }

  function changeBioText() {
    var edit_text = document.getElementById("bio-input").value;
    console.log(edit_text)
    document.getElementById("bio_text").innerHTML = edit_text;
  }

  function loadAvatar(event) {
    var avatars = document.getElementsByClassName("avatar-img");
    for (i = 0; i < avatars.length; i++) {
      avatars[i].src = URL.createObjectURL(event.target.files[0])
    }
  }

  $('#avatar-submit').on("click", function(event) {
    $('#avatarModal').modal( 'hide' );
  });

  $('#bio-submit').on("click", function(event) {
    changeBioText();
    $('#bioModal').modal( 'hide' );
  });
</script>